<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="손쉽게 포트폴리오를 관리하고 수익률을 추적하세요. 거래 내역 추가, 실현 손익을 반영한 평단가 계산, 직관적인 포트폴리오 구성 현황 분석, 그리고 포트폴리오 저장/불러오기 기능을 모두 한곳에서 경험할 수 있습니다.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="naver-site-verification" content="d095e22faf2f97691218fc82f14cfed0f5bafeca" />
    <title>주식 평단가 계산기</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>📈 주식 평단가 계산기</h1>
            <p>주식 거래 내역을 입력하여 평단가를 계산하고 포트폴리오를 관리하세요</p>
        </header>

        <main>
            <div class="input-section">
                <h2>거래 내역 추가</h2>
                <form id="transactionForm" class="transaction-form">
                    <div class="form-group">
                        <label for="stockName">종목명</label>
                        <input type="text" id="stockName" list="stockNames" placeholder="예: 엔비디아" required>
                        <datalist id="stockNames"></datalist>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="quantity">수량</label>
                            <input type="number" id="quantity" placeholder="주" min="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="price">단가</label>
                            <input type="number" id="price" placeholder="달러" min="0.01" step="0.01" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="transactionType">거래 유형</label>
                        <select id="transactionType" required>
                            <option value="buy">매수</option>
                            <option value="sell">매도</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">거래 추가</button>
                        <button type="button" id="openBulkTransactionModal" class="btn-secondary">대량 거래 내역 추가</button>
                    </div>
                </form>
            </div>

            <div class="portfolio-section">
                <h2>포트폴리오 현황</h2>
                <div id="portfolioSummary" class="portfolio-summary">
                    <div class="summary-card">
                        <h3>총 보유 종목</h3>
                        <span id="totalStocks">0</span>개
                    </div>
                    <div class="summary-card">
                        <h3>총 투자금액</h3>
                        <span id="totalInvestment">0</span>달러
                    </div>
                    <div class="summary-card">
                        <h3>총 평가금액</h3>
                        <span id="totalValue">0</span>달러
                    </div>
                    <div class="summary-card">
                        <h3>수익률</h3>
                        <span id="profitRate">0</span>%
                    </div>
                </div>
            </div>

            <div class="stocks-section">
                <h2 class="section-title-with-checkbox">보유 종목 상세
                    <div class="form-group pnl-checkbox-group">
                        <label for="includeRealizedPnlInAvgCost" style="display: flex; align-items: center; gap: 8px; margin-bottom: 0;">
                            <input type="checkbox" id="includeRealizedPnlInAvgCost" style="margin-right: 8px;">
                            실현 손익 포함하여 평단가 계산 
                            <span class="help-icon" onclick="event.stopPropagation(); stockCalculator.showPnlCalculationExplanation();">?</span>
                        </label>
                    </div>
                </h2>
                <div id="stocksList" class="stocks-list">
                    <div class="empty-state">
                        <p>아직 거래 내역이 없습니다.</p>
                        <p>위에서 첫 번째 거래를 추가해보세요!</p>
                    </div>
                </div>
            </div>

            <div class="chart-section">
                <h2>포트폴리오 구성</h2>
                <div class="chart-content">
                    <div class="chart-container">
                        <canvas id="portfolioChart"></canvas>
                    </div>
                    <div id="portfolioPercentages" class="portfolio-percentages">
                        <!-- 종목별 퍼센트 목록이 여기에 동적으로 추가됩니다 -->
                    </div>
                </div>
            </div>

            <div class="portfolio-actions">
                <button id="savePortfolio" class="btn-primary">포트폴리오 저장</button>
                <input type="file" id="loadPortfolioInput" accept=".json" style="display: none;">
                <button id="loadPortfolio" class="btn-primary">포트폴리오 불러오기</button>
                <button id="openHelpModal" class="btn-secondary">도움말</button>
                <button id="contactUsBtn" class="btn-secondary">문의하기</button>
            </div>
        </main>
    </div>

    <!-- 거래 내역 모달 -->
    <div id="transactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">거래 내역</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div id="modalSummary" class="modal-summary"></div>
                <div id="modalTransactions" class="modal-transactions"></div>
            </div>
        </div>
    </div>

    <!-- 대량 거래 내역 모달 -->
    <div id="bulkTransactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>대량 거래 내역 추가</h2>
                <span class="close" id="closeBulkTransactionModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="bulkStockName">종목명</label>
                    <input type="text" id="bulkStockName" list="stockNames" placeholder="예: 엔비디아" required>
                </div>
                <textarea id="bulkTransactionText" placeholder="여기에 거래 내역을 붙여넣으세요. (토스증권 주문 내역을 복사/붙여넣기 하세요.) 
(예시:
8.19
판매 6주
주당 $77.76

6.16
판매 4주
주당 $72.51

5.14
구매 8주
주당 $68.11

5.14
구매 8주
주당 $70.71)" rows="15"></textarea>
                <button id="addBulkTransactions" class="btn-primary">대량 거래 추가</button>
            </div>
        </div>
    </div>

    <!-- 평단가 계산 설명 모달 -->
    <div id="pnlExplanationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>평단가 계산 방식 설명</h2>
                <span class="close" id="closePnlExplanationModal">&times;</span>
            </div>
            <div class="modal-body" id="pnlExplanationModalBody">
                <!-- 설명 내용이 여기에 삽입됩니다 -->
            </div>
        </div>
    </div>

    <!-- 도움말 모달 -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>도움말</h2>
                <span class="close" id="closeHelpModal">&times;</span>
            </div>
            <div class="modal-body" id="helpModalBody">
                <!-- 도움말 내용이 여기에 삽입됩니다 -->
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
